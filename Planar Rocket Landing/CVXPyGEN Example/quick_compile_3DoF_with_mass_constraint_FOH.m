src_folders = { ...
    "Ast2Ast_fixed_FOH_PTR_ECOS/c/src", ...
    "Ast2Ast_fixed_FOH_PTR_ECOS/c/solver_code/src", ...
    "Ast2Ast_fixed_FOH_PTR_ECOS/c/solver_code/ecos_bb", ...
	"Ast2Ast_fixed_FOH_PTR_ECOS/c/solver_code/external/amd/src/", ...
	"Ast2Ast_fixed_FOH_PTR_ECOS/c/solver_code/external/ldl/src/", ...
};

% Collect all .c files from each folder
all_src_files = {};
for k = 1:numel(src_folders)
    src_info = dir(fullfile(src_folders{k}, "*.c"));
    % full paths as cell array
    all_src_files = [all_src_files, fullfile({src_info.folder}, {src_info.name})];
end

mex( ...
    "cpg_solve_wrap_Ast2Ast.c", ...
    all_src_files{:}, ...
    "-I./Ast2Ast_fixed_FOH_PTR_ECOS/c/include", ...
    "-IAst2Ast_fixed_FOH_PTR_ECOS/c/solver_code/include", ...
    "-IAst2Ast_fixed_FOH_PTR_ECOS/c/solver_code/external/amd/include", ...
    "-IAst2Ast_fixed_FOH_PTR_ECOS/c/solver_code/external/ldl/include", ...
    "-IAst2Ast_fixed_FOH_PTR_ECOS/c/solver_code/external/SuiteSparse_config" ...
);